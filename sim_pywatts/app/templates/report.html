{% extends "base.html" %}

{% block content %}
<div class="container report-container">
    <div class="dashboard-header">
        <div>
            <h1><i class="fas fa-chart-pie"></i> An√°lisis Energ√©tico</h1>
            <p style="color: var(--text-secondary);">Reporte detallado para {{ usuario.nombre_usuario }}</p>
        </div>
        <div>
            <a href="{{ url_for('generar_pdf', usuario_id=usuario.id) }}" class="btn btn-primary">
                <i class="fas fa-file-pdf"></i> Descargar Reporte PDF
            </a>
            <a href="{{ url_for('dashboard', usuario_id=usuario.id) }}" class="btn" style="background-color: #333; color: white; margin-left: 10px;">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
        </div>
    </div>

    <div class="impact-box" style="background: linear-gradient(135deg, #1e1e1e 0%, #2d3436 100%); padding: 30px; border-radius: 15px; margin-top: 30px; border: 1px solid #333; position: relative; overflow: hidden;">
        <i class="fas fa-leaf" style="position: absolute; right: -20px; top: -20px; font-size: 10rem; color: rgba(78, 205, 196, 0.05); transform: rotate(15deg);"></i>
        
        <h2 style="color: var(--accent-color); position: relative; z-index: 1;">
            <i class="fas fa-globe-americas"></i> Tu Huella Ecol√≥gica Positiva
        </h2>
        
        <p style="color: #aaa; max-width: 800px; margin: 0 auto 30px auto; font-size: 0.95rem; position: relative; z-index: 1;">
            Al reducir tu consumo el√©ctrico, evitas que las plantas generadoras quemen combustibles f√≥siles. 
            Aqu√≠ te mostramos el impacto real de tu ahorro en t√©rminos ambientales.
        </p>

        <div class="stats-grid" style="position: relative; z-index: 1;">
            <div class="stat-card-savings">
                <div class="icon"><i class="fas fa-piggy-bank"></i></div>
                <div class="info">
                    <h3>Dinero Ahorrado</h3>
                    <div class="value" style="color: #2ecc71;">${{ ahorro_total.ahorro_pesos }}</div>
                    <small style="color: #777;">MXN Bimestrales</small>
                </div>
            </div>

            <div class="stat-card">
                <div class="icon" style="color: #e67e22;"><i class="fas fa-smog"></i></div>
                <div class="info">
                    <h3>Emisiones Evitadas</h3>
                    <div class="value">{{ impacto_ambiental.co2_kg_ahorrado }} kg</div>
                    <small style="color: #777;">De CO‚ÇÇ a la atm√≥sfera</small>
                </div>
            </div>

            <div class="stat-card">
                <div class="icon" style="color: #4ECDC4;"><i class="fas fa-tree"></i></div>
                <div class="info">
                    <h3>Equivalencia Forestal</h3>
                    <div class="value">{{ impacto_ambiental.equivalente_arboles }}</div>
                    <small style="color: #777;">√Årboles limpiando aire/a√±o</small>
                </div>
            </div>

            <div class="stat-card">
                <div class="icon" style="color: #FF6B6B;"><i class="fas fa-car-side"></i></div>
                <div class="info">
                    <h3>Menos Conducci√≥n</h3>
                    <div class="value">{{ impacto_ambiental.equivalente_km_auto }} km</div>
                    <small style="color: #777;">De recorrido en auto</small>
                </div>
            </div>
        </div>

        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-top: 20px; display: inline-block;">
            <p style="font-size: 1rem; margin: 0; color: #e0e0e0;">
                <i class="fas fa-info-circle" style="color: var(--accent-color);"></i> 
                {{ impacto_ambiental.mensaje }}
            </p>
        </div>
    </div>

    <div class="section-header" style="margin-top: 40px;">
        <h2><i class="fas fa-chart-bar"></i> Visualizaci√≥n de Consumo</h2>
    </div>
    
    <div class="chart-grid">
        <div class="chart-card">
            <h3>Consumo por Dispositivo</h3>
            <img src="data:image/png;base64,{{ grafica_barras }}" alt="Gr√°fica de Barras">
        </div>
        <div class="chart-card">
            <h3>Distribuci√≥n del Consumo</h3>
            <img src="data:image/png;base64,{{ grafica_pie }}" alt="Gr√°fica de Pastel">
        </div>
    </div>

    <div class="section-header">
        <h2><i class="fas fa-lightbulb"></i> Plan de Optimizaci√≥n</h2>
    </div>

    <div class="recommendations-section">
        {% if recomendaciones.criticas %}
            <h3 style="color: var(--danger-color);">üî¥ Prioridad Alta (Acci√≥n Inmediata)</h3>
            {% for rec in recomendaciones.criticas %}
            <div class="rec-card priority-criticas">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h4>{{ rec.dispositivo }}</h4>
                    <span style="background: rgba(255,107,107,0.2); color: #ff6b6b; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem;">
                        Ahorro: ${{ rec.ahorro_potencial_pesos }}
                    </span>
                </div>
                <p><strong>Acci√≥n:</strong> {{ rec.accion_principal }}</p>
                {% if rec.consejos_especificos %}
                <ul style="color: var(--text-secondary); font-size: 0.9rem;">
                    {% for consejo in rec.consejos_especificos %}
                        <li>{{ consejo }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            {% endfor %}
        {% endif %}

        {% if recomendaciones.importantes %}
            <h3 style="color: #f7dc6f; margin-top: 30px;">üü° Prioridad Media</h3>
            {% for rec in recomendaciones.importantes %}
            <div class="rec-card priority-importantes">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h4>{{ rec.dispositivo }}</h4>
                    <span style="background: rgba(247,220,111,0.2); color: #f7dc6f; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem;">
                        Ahorro: ${{ rec.ahorro_potencial_pesos }}
                    </span>
                </div>
                <p>{{ rec.accion_principal }}</p>
            </div>
            {% endfor %}
        {% endif %}

        <div class="rec-card" style="margin-top: 30px; border-left-color: var(--accent-color);">
            <h3>üí° Consejos Generales</h3>
            <ul>
                {% for gen in recomendaciones.generales %}
                    <li>{{ gen }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}      